/* 
 * Reuters Media News Beacon
 * Modified from Piwik
 * License: http://www.opensource.org/licenses/bsd-license.php BSD Simplified
 * License file: http://mediacdn.reuters.com/pulse/2/LICENSE.txt
 * Source: http://mediacdn.reuters.com/pulse/2/trb-src.js
 */
if(!this.JSON)this.JSON={};
(function(){function u(g){return g<10?"0"+g:g}function q(g){K.lastIndex=0;return K.test(g)?'"'+g.replace(K,function(g){var f=G[g];return typeof f==="string"?f:"\\u"+("0000"+g.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function r(g,y){var f,i,e,z,j=l,k,b=y[g];b&&typeof b==="object"&&typeof b.toJSON==="function"&&(b=b.toJSON(g));typeof C==="function"&&(b=C.call(y,g,b));switch(typeof b){case "string":return q(b);case "number":return isFinite(b)?String(b):"null";case "boolean":case "null":return String(b);
case "object":if(!b)return"null";l+=o;k=[];if(Object.prototype.toString.apply(b)==="[object Array]"){z=b.length;for(f=0;f<z;f+=1)k[f]=r(f,b)||"null";e=k.length===0?"[]":l?"[\n"+l+k.join(",\n"+l)+"\n"+j+"]":"["+k.join(",")+"]";l=j;return e}if(C&&typeof C==="object"){z=C.length;for(f=0;f<z;f+=1)i=C[f],typeof i==="string"&&(e=r(i,b))&&k.push(q(i)+(l?": ":":")+e)}else for(i in b)Object.hasOwnProperty.call(b,i)&&(e=r(i,b))&&k.push(q(i)+(l?": ":":")+e);e=k.length===0?"{}":l?"{\n"+l+k.join(",\n"+l)+"\n"+
j+"}":"{"+k.join(",")+"}";l=j;return e}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+u(this.getUTCMonth()+1)+"-"+u(this.getUTCDate())+"T"+u(this.getUTCHours())+":"+u(this.getUTCMinutes())+":"+u(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var w=RegExp("[\x00\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]",
"g"),K=RegExp('[\\\\\\"\x00-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]',"g"),l,o,G={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},C;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,y,f){var i;o=l="";if(typeof f==="number")for(i=0;i<f;i+=1)o+=" ";else typeof f==="string"&&(o=f);if((C=y)&&typeof y!=="function"&&(typeof y!=="object"||typeof y.length!=="number"))throw Error("JSON.stringify");
return r("",{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,l){function f(e,g){var j,i,b=e[g];if(b&&typeof b==="object")for(j in b)Object.hasOwnProperty.call(b,j)&&(i=f(b,j),i!==void 0?b[j]=i:delete b[j]);return l.call(e,g,b)}var i,g=String(g);w.lastIndex=0;w.test(g)&&(g=g.replace(w,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(g.replace(RegExp('\\\\(?:["\\\\/bfnrt]|u[0-9a-fA-F]{4})',"g"),"@").replace(RegExp('"[^"\\\\n\\r]*"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?',
"g"),"]").replace(RegExp("(?:^|:|,)(?:\\s*\\[)+","g"),"")))return i=eval("("+g+")"),typeof l==="function"?f({"":i},""):i;throw new SyntaxError("JSON.parse");}})();
var _baq=_baq||[],TRNewsBeacon=TRNewsBeacon||function(){function u(a){return typeof a==="string"||a instanceof String}function q(a){var t=a.shift();u(t)?D[t].apply(D,a):t.apply(D,a)}function r(a,t,b,d){if(a.addEventListener)return a.addEventListener(t,b,d),!0;if(a.attachEvent)return a.attachEvent("on"+t,b);a["on"+t]=b}function w(){var a;if(!k){k=!0;for(a=0;a<b.length;a++)b[a]()}return!0}function K(){var a="";try{a=top.document.referrer}catch(t){if(parent)try{a=parent.document.referrer}catch(b){a=
""}}if(a==="")a=e.referrer;return a}function l(a){var t=/^(?:(?:https?|ftp):)\/*(?:[^@]+@)?([^:/#]+)/.exec(a);return t?t[1]:a}function o(a,t,b,d,g,i){var f;b&&(f=new Date,f.setTime(f.getTime()+b));e.cookie=a+"="+x(t)+(b?";expires="+f.toGMTString():"")+";path="+(d?d:"/")+(g?";domain="+g:"")+(i?";secure":"")}function G(a){return(a=RegExp("(^|;)[ ]*"+a+"=([^;]*)").exec(e.cookie))?L(a[2]):0}function C(a){var b=function(a,b){return a<<b|a>>>32-b},g=function(a){var b="",d,e;for(d=7;d>=0;d--)e=a>>>d*4&15,
b+=e.toString(16);return b},d,e,f=[],i=1732584193,l=4023233417,j=2562383102,k=271733878,o=3285377520,h,m,n,s,p,v=[],a=unescape(x(a));h=a.length;for(d=0;d<h-3;d+=4)e=a.charCodeAt(d)<<24|a.charCodeAt(d+1)<<16|a.charCodeAt(d+2)<<8|a.charCodeAt(d+3),v.push(e);switch(h&3){case 0:d=2147483648;break;case 1:d=a.charCodeAt(h-1)<<24|8388608;break;case 2:d=a.charCodeAt(h-2)<<24|a.charCodeAt(h-1)<<16|32768;break;case 3:d=a.charCodeAt(h-3)<<24|a.charCodeAt(h-2)<<16|a.charCodeAt(h-1)<<8|128}for(v.push(d);(v.length&
15)!==14;)v.push(0);v.push(h>>>29);v.push(h<<3&4294967295);for(a=0;a<v.length;a+=16){for(d=0;d<16;d++)f[d]=v[a+d];for(d=16;d<=79;d++)f[d]=b(f[d-3]^f[d-8]^f[d-14]^f[d-16],1);e=i;h=l;m=j;n=k;s=o;for(d=0;d<=19;d++)p=b(e,5)+(h&m|~h&n)+s+f[d]+1518500249&4294967295,s=n,n=m,m=b(h,30),h=e,e=p;for(d=20;d<=39;d++)p=b(e,5)+(h^m^n)+s+f[d]+1859775393&4294967295,s=n,n=m,m=b(h,30),h=e,e=p;for(d=40;d<=59;d++)p=b(e,5)+(h&m|h&n|m&n)+s+f[d]+2400959708&4294967295,s=n,n=m,m=b(h,30),h=e,e=p;for(d=60;d<=79;d++)p=b(e,5)+
(h^m^n)+s+f[d]+3395469782&4294967295,s=n,n=m,m=b(h,30),h=e,e=p;i=i+e&4294967295;l=l+h&4294967295;j=j+m&4294967295;k=k+n&4294967295;o=o+s&4294967295}p=g(i)+g(l)+g(j)+g(k)+g(o);return p.toLowerCase()}function g(a,b,f){var c;a==="webcache.googleusercontent.com"||a==="cc.bingj.com"||a.slice(0,5)==="74.6."?(b=e.links[0].href,a=l(b)):a==="translate.googleusercontent.com"&&(f===""&&(f=b),a=/^(?:https?|ftp)(?::\/*(?:[^?]+)[?])([^#]+)/.exec(b),b=/(?:^|&)u=([^&]*)/,c=(a=a?b.exec(a[1]):0)?L(a[1]):"",b=c,a=l(b));
return[a,b,f]}function y(a){var b=a.length;return a.charAt(--b)==="."?a.slice(0,b):a}function f(a){function f(c){var a;return W?(a=/#.*/,c.replace(a,"")):c}function w(c){var a,b,d;for(a=0;a<N.length;a++){b=N[a].toLowerCase();if(c===b)return!0;if(b.slice(0,2)==="*."){if(c===b.slice(2))return!0;d=c.length-b.length+1;if(d>0&&c.slice(d)===b.slice(1))return!0}}return!1}function d(c){var a=new Image(1,1);a.onLoad=function(){};root=X?"k":"n";a.src=ja+"/"+root+"/"+ka+"/b.gif?"+c}function q(c,a){var b=new Date;
R||(d(c),i=b.getTime()+a)}function D(){H=Y((A||v)+(B||"/")).slice(0,8)}function F(){var c=G(I+"cvar."+H);return c.length&&(c=JSON.parse(c),typeof c==="object")?c:{}}function P(c){var a=new Date,b=Math.round(a.getTime()/1E3),d,g,i,h,j,k,m=I+"id."+H,n=I+"ses."+H,p=I+"ref."+H,s=I+"cv."+H;h=G(m);var u=G(n);k=G(p);var r=e.location.protocol==="https",q="";if(R)return o(m,"",-1,B,A),o(n,"",-1,B,A),o(s,"",-1,B,A),o(p,"",-1,B,A),"";h?(d=h.split("."),a=d[0],h=d[1],i=d[2],j=d[3],d=d[4]):(j=h=b,d="",a=Y((z.userAgent||
"")+(z.platform||"")+q+Math.round(a.getTime/1E3)).slice(0,16),i=0);Z=a;k&&(g=k.indexOf("."),k.slice(0,g),k.slice(g+1));if(u)M="-",session_id=u;else if(session_id=(new Date).getTime(),i++,d=j,j=l(M),k=k?l(k):"",j.length&&!w(j)&&(!$||!k.length||w(k)))k=M,o(p,b+"."+k,aa,B,A,r);j=b;b=JSON.stringify(E);o(m,a+"."+h+"."+i+"."+j+"."+d,ba,B,A,r);o(n,session_id,S,B,A,r);o(s,b,S,B,A,r);q="id="+x(ca)+"&s="+x(session_id)+"&u="+x(f(da||ia))+"&r="+x(f(M))+"&d="+x(v)+"&cv="+b+q;c?q+="&data="+x(JSON.stringify(c)):
J&&(q+="&data="+x(JSON.stringify(J)));return q}function L(c,a){var b;a:{mlist=e.getElementsByTagName("meta");for(b=0;b<mlist.length;b++)if(mlist[b].httpEquiv=="X-Translated-By"){b=!0;break a}b=!1}b&&(T+=" (translated)");b=P(a)+"&h="+x(c||T);q(b,O)}function Q(c,a){var b,d="(^| )(trnb[_-]"+a;if(c)for(b=0;b<c.length;b++)d+="|"+c[b];d+=")( |$)";return RegExp(d)}function V(c){for(var a,b;(a=c.parentNode)&&(b=c.tagName)!=="A"&&b!=="AREA";)c=a;if(typeof c.href!=="undefined"&&(a=c.hostname||l(c.href),b=a.toLowerCase(),
a=c.href.replace(a,b),!/^(javascript|vbscript|jscript|mocha|livescript|ecmascript): */i.test(a))){c=c.className;if(w(b)){b=Q(ea,"download");var d=Q(fa,"link"),e=RegExp("\\.("+U+")([?&#]|$)","i"),c=d.test(c)?"link":b.test(c)||e.test(a)?"download":0}else c="link";c&&(a=P(void 0)+"&"+c+"="+x(f(a)),q(a,O))}}function h(c){var a,b,c=c||j.event;a=c.which||c.button;b=c.target||c.srcElement;c.type==="click"?b&&V(b):c.type==="mousedown"?(a===1||a===2)&&b?(lastButton=a,lastTarget=b):lastButton=lastTarget=null:
c.type==="mouseup"&&(a===lastButton&&b===lastTarget&&V(b),lastButton=lastTarget=null)}function m(c,a){a?(r(c,"mouseup",h,!1),r(c,"mousedown",h,!1)):r(c,"click",h,!1)}function n(c){if(!linkTrackingInstalled){linkTrackingInstalled=!0;var a,b=Q(ga,"ignore"),d=e.links;if(d)for(a=0;a<d.length;a++)b.test(d[a].className)||m(d[a],c)}}var s={},p=g(e.domain,j.location.href,K()),v=y(p[0]),ia=p[1],M=p[2],ja="http://pulse-analytics-beacon.reutersmedia.net",ka=2,ca=a||"",da,X=!0,T=e.title,U="7z|aac|ar[cj]|as[fx]|avi|bin|csv|deb|dmg|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|ms[ip]|od[bfgpst]|og[gv]|pdf|phps|png|ppt|qtm?|ra[mr]?|rpm|sea|sit|tar|t?bz2?|tgz|torrent|txt|wav|wm[av]|wpd||xls|xml|z|zip",
N=[v],ga=[],ea=[],fa=[],O=500,W,J,I="_tr_",A,B,R,$=!1,ba=63072E6,S=18E5,aa=15768E6,E=!1,Z,Y=C,H;(function(){var c=I+"testcookie."+H;return typeof z.cookieEnabled==="undefined"?(o(c,"1"),G(c)==="1"?"1":"0"):z.cookieEnabled?"1":"0"})();D();return{hook:s,getHook:function(c){return s[c]},getVisitorId:function(){return Z},setDebugBeaconCall:function(){},setClientId:function(c){ca=c},setCustomData:function(c,a){typeof c==="object"?J=c:(J||(J=[]),J[c]=a)},getCustomData:function(){return J},setCustomVariable:function(c,
a,b){E===!1&&(E=F());c>0&&c<=5&&(E[c]=[a.slice(0,100),b.slice(0,100)])},getCustomVariable:function(c){E===!1&&(E=F());return E[c]},deleteCustomVariable:function(c){this.setCustomVariable(c,"","")},setLinkTrackingTimer:function(c){O=c},setDownloadExtensions:function(c){U=c},addDownloadExtensions:function(c){U+="|"+c},setDomains:function(c){N=u(c)?[c]:c;N.push(v)},setIgnoreClasses:function(c){ga=u(c)?[c]:c},setReferrerUrl:function(c){M=c},setCustomUrl:function(c){da=c},setDocumentTitle:function(c){T=
c},setDownloadClasses:function(c){ea=u(c)?[c]:c},setLinkClasses:function(c){fa=u(c)?[c]:c},discardHashTag:function(c){W=c},setCookieNamePrefix:function(c){I=c;E=F()},setNoThirdPartyCookie:function(){X=!1},setCookieDomain:function(c){A=y(c);D()},setCookiePath:function(c){B=c;D()},setVisitorCookieTimeout:function(c){ba=c*1E3},setSessionCookieTimeout:function(c){S=c*1E3},setReferralCookieTimeout:function(c){aa=c*1E3},setConversionAttributionFirstReferrer:function(c){$=c},setDoNotTrack:function(c){R=
c&&z.doNotTrack},addListener:function(c,a){m(c,a)},enableLinkTracking:function(a){k?n(a):b[b.length]=function(){n(a)}},killFrame:function(){if(j!==top)top.location=j.location},redirectFile:function(a){if(j.location.protocol==="file:")j.location=a},trackLink:function(a,b,d){a=P(d)+"&"+b+"="+x(f(a));q(a,O)},trackPageViewCustom:function(a,b){L(a,b)},trackPageView:function(){L(null,null)}}}var i,e=document,z=navigator,j=window,k=!1,b=[],x=j.encodeURIComponent,L=j.decodeURIComponent,D,F;r(j,"beforeunload",
function(){if(i){var a;do a=new Date;while(a.getTime()<i)}},!1);(function(){e.addEventListener?r(e,"DOMContentLoaded",function t(){e.removeEventListener("DOMContentLoaded",t,!1);w()}):e.attachEvent&&(e.attachEvent("onreadystatechange",function ha(){e.readyState==="complete"&&(e.detachEvent("onreadystatechange",ha),w())}),e.documentElement.doScroll&&j===top&&function d(){if(!k){try{e.documentElement.doScroll("left")}catch(b){setTimeout(d,0);return}w()}}());r(j,"load",w,!1)})();D=new f;for(F=0;F<_baq.length;F++)q(_baq[F]);
_baq=new function(){return{push:q}};return{getTracker:function(a){return new f(a)},getAsyncTracker:function(){return D}}}();
